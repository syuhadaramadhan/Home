<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus & Goals</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;700&display=swap');
        :root{--bg-color:#121212;--surface-color:#1E1E1E;--primary-color:#BB86FC;--primary-variant-color:#3700B3;--secondary-color:#03DAC6;--text-color:#E0E0E0;--text-muted-color:#A0A0A0;--border-color:#3f3f3f}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Poppins',sans-serif;background-color:var(--bg-color);color:var(--text-color);display:flex;flex-direction:column;align-items:center;min-height:100vh;overflow-y:auto}.navbar{width:100%;height:70px;position:fixed;top:0;left:0;display:flex;align-items:center;justify-content:space-between;padding:0 40px;background:rgba(30,30,30,.7);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-bottom:1px solid var(--border-color);z-index:100}.logo{display:flex;align-items:center;gap:12px;color:var(--text-color);text-decoration:none}.logo-icon{width:32px;height:32px}.logo-text{font-size:1.5rem;font-weight:600}#settings-btn{position:static;background:none;border:none;color:var(--text-muted-color);font-size:1.8rem;cursor:pointer;transition:color .3s ease,transform .3s ease}#settings-btn:hover{color:var(--primary-color);transform:rotate(45deg)}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%{transform:scale(1);box-shadow:0 0 10px var(--secondary-color),0 0 20px var(--secondary-color)}50%{transform:scale(1.02);box-shadow:0 0 20px var(--secondary-color),0 0 40px var(--secondary-color)}100%{transform:scale(1);box-shadow:0 0 10px var(--secondary-color),0 0 20px var(--secondary-color)}}.main-content{display:flex;flex-grow:1;width:100%;align-items:center;justify-content:center;padding-top:70px}.dashboard-container{display:flex;gap:40px;width:100%;max-width:1200px;padding:20px;animation:fadeIn .8s ease-out}.panel{background-color:var(--surface-color);border-radius:16px;padding:30px;border:1px solid #2c2c2c;box-shadow:0 8px 32px rgba(0,0,0,.2);transition:transform .3s ease,box-shadow .3s ease}.panel:hover{transform:translateY(-5px);box-shadow:0 12px 40px rgba(0,0,0,.3)}.panel-title-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.panel-title{font-size:1.5rem;font-weight:600;color:var(--text-color);border-bottom:2px solid var(--primary-color);padding-bottom:10px;display:inline-block;margin-bottom:0}.timer-panel{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}.mode-selectors{display:flex;justify-content:center;gap:10px;margin-bottom:20px}.mode-btn{background-color:transparent;border:1px solid var(--border-color);color:var(--text-muted-color);padding:8px 18px;border-radius:8px;cursor:pointer;font-size:.9rem;font-weight:500;transition:all .3s ease}.mode-btn:hover{background-color:var(--border-color);color:var(--text-color)}.mode-btn.active{background-color:var(--primary-color);color:var(--bg-color);border-color:var(--primary-color);font-weight:600}#mode-display{font-size:1.8rem;font-weight:300;color:var(--secondary-color);margin-bottom:10px;letter-spacing:2px;text-transform:uppercase}#timer-display{font-family:'Roboto Mono',monospace;font-size:7rem;font-weight:700;margin-bottom:30px;color:var(--text-color);text-shadow:0 0 10px rgba(255,255,255,.1)}.timer-controls button{background-color:transparent;border:2px solid var(--primary-color);color:var(--primary-color);padding:12px 28px;margin:0 10px;border-radius:8px;cursor:pointer;font-size:1rem;font-weight:600;transition:all .3s ease}.timer-controls button:hover{background-color:var(--primary-color);color:var(--bg-color);box-shadow:0 0 15px var(--primary-color)}.timer-controls button#start-pause-btn.running{background-color:var(--secondary-color);border-color:var(--secondary-color);color:var(--bg-color)}.timer-panel.on-break{animation:pulse 2s infinite ease-in-out;--secondary-color:#03dac6}.timer-panel.on-focus{--secondary-color:#bb86fc}.goals-panel{flex:1}#clear-completed-btn{display:none;align-items:center;gap:8px;background-color:transparent;border:1px solid var(--border-color);color:var(--text-muted-color);font-size:.8rem;font-weight:500;padding:6px 12px;border-radius:8px;cursor:pointer;transition:all .2s ease-in-out}#clear-completed-btn svg{width:14px;height:14px;fill:currentColor;transition:fill .2s ease-in-out}#clear-completed-btn:hover{background-color:#ff5252;border-color:#ff5252;color:#fff;transform:translateY(-2px);box-shadow:0 4px 12px rgba(255,82,82,.2)}#task-form{display:flex;gap:10px;margin-bottom:20px}#task-input{flex-grow:1;background-color:var(--bg-color);border:1px solid #2c2c2c;border-radius:8px;padding:12px;font-size:1rem;color:var(--text-color);transition:border-color .3s ease}#task-input:focus{outline:none;border-color:var(--primary-color)}#add-task-btn{background-color:var(--primary-color);border:none;color:var(--bg-color);border-radius:8px;padding:0 20px;font-size:1.5rem;cursor:pointer;transition:background-color .3s ease}#add-task-btn:hover{background-color:var(--primary-variant-color)}#task-list{list-style:none;max-height:300px;overflow-y:auto}#task-list li{display:flex;align-items:center;background-color:var(--bg-color);padding:15px;border-radius:8px;margin-bottom:10px;border:1px solid #2c2c2c;transition:background-color .3s ease,opacity .3s ease,transform .5s cubic-bezier(.55,0,.1,1)}#task-list li.completed{background-color:#2a2a2a;opacity:.6}#task-list li.completed .task-text{text-decoration:line-through;color:var(--text-muted-color)}#task-list li label{display:flex;align-items:center;cursor:pointer;flex-grow:1}.task-checkbox{position:absolute;opacity:0;cursor:pointer;height:0;width:0}.custom-checkbox{position:relative;height:20px;width:20px;background-color:transparent;border:2px solid var(--text-muted-color);border-radius:4px;margin-right:15px;transition:all .2s ease}.task-checkbox:checked~.custom-checkbox{background-color:var(--secondary-color);border-color:var(--secondary-color)}.custom-checkbox:after{content:"";position:absolute;display:none;left:6px;top:2px;width:5px;height:10px;border:solid var(--surface-color);border-width:0 3px 3px 0;transform:rotate(45deg)}.task-checkbox:checked~.custom-checkbox:after{display:block}.task-text{flex-grow:1}.delete-btn{background:none;border:none;color:var(--text-muted-color);font-size:1.2rem;cursor:pointer;transition:color .3s ease}.delete-btn:hover{color:#ff5252}.settings-modal{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:200}.settings-content{background:rgba(30,30,30,.85);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-radius:20px;border:1px solid rgba(255,255,255,.1);box-shadow:0 8px 32px 0 rgba(0,0,0,.37);padding:30px 40px;width:90%;max-width:750px}.close-modal-btn{position:absolute;top:15px;right:15px;background:rgba(255,255,255,.1);border:none;border-radius:50%;width:30px;height:30px;display:flex;justify-content:center;align-items:center;font-size:1.2rem;color:var(--text-muted-color);cursor:pointer;transition:background-color .3s ease,color .3s ease}.close-modal-btn:hover{background-color:var(--primary-color);color:var(--bg-color)}.settings-columns-container{display:flex;gap:40px}.settings-column{flex:1}#settings-form h3{font-weight:600;font-size:1.2rem;margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid var(--border-color)}.setting-row{display:flex;justify-content:space-between;align-items:center;padding:15px 5px;transition:background-color .2s ease;border-radius:8px}.setting-row:hover{background-color:rgba(255,255,255,.05)}.setting-row label{font-size:1rem;color:var(--text-color)}.number-input-wrapper{position:relative;width:120px;height:38px}.setting-row input[type=number]{width:100%;height:100%;background-color:rgba(0,0,0,.3);border:1px solid var(--border-color);color:var(--text-color);border-radius:8px;padding:8px 28px 8px 12px;font-size:1rem;font-family:'Poppins',sans-serif;text-align:right;transition:all .3s ease;-moz-appearance:textfield}.setting-row input[type=number]::-webkit-inner-spin-button,.setting-row input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.adjust-btn{position:absolute;right:7px;width:14px;height:14px;background:none;border:none;color:var(--text-muted-color);cursor:pointer;transition:color .2s ease;display:flex;justify-content:center;align-items:center}.adjust-btn:hover{color:var(--primary-color)}.adjust-btn.up{top:4px}.adjust-btn.down{bottom:4px}.adjust-btn svg{width:100%;height:100%;fill:currentColor}.setting-row select{width:120px;background-color:rgba(0,0,0,.3);border:1px solid var(--border-color);color:var(--text-color);border-radius:8px;padding:8px 12px;font-size:1rem;font-family:'Poppins',sans-serif;text-align:left;transition:all .3s ease;cursor:pointer;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23A0A0A0' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}.setting-row input:focus,.setting-row select:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(187,134,252,.25)}.setting-row select option{background:var(--surface-color);color:var(--text-color)}.button-group{margin-top:30px}#save-settings-btn{width:100%;padding:15px;background:linear-gradient(45deg,var(--primary-variant-color),var(--primary-color));border:none;border-radius:10px;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:transform .3s ease,box-shadow .3s ease}#save-settings-btn:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(187,134,252,.2)}.switch{position:relative;display:inline-block;width:50px;height:28px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#333;transition:.4s;border-radius:28px}.slider:before{position:absolute;content:"";height:20px;width:20px;left:4px;bottom:4px;background-color:#fff;transition:.4s;border-radius:50%}input:checked+.slider{background-color:var(--secondary-color)}input:checked+.slider:before{transform:translateX(22px)}#enable-sound-btn{position:fixed;bottom:20px;right:20px;background:var(--primary-color);color:#121212;font-weight:600;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;z-index:200;box-shadow:0 4px 15px rgba(0,0,0,.3)}#enable-sound-btn.hidden{display:none}@media (max-width:900px){.dashboard-container{flex-direction:column}body{height:auto;overflow:visible}}@media (max-width:768px){.settings-columns-container{flex-direction:column;gap:0}.settings-content{max-width:480px}.navbar{padding:0 20px}}@media (max-width:600px){#timer-display{font-size:4rem}.panel{padding:20px}.settings-content{padding:20px 25px}.setting-row{flex-direction:column;align-items:flex-start;padding:10px 0}.setting-row label{margin-bottom:8px}.setting-row .number-input-wrapper,.setting-row select{width:100%}.setting-row input[type=number]{text-align:left}.logo-text{display:none}}
    </style>
</head>

<body>

    <div class="navbar">
        <a href="#" class="logo">
            <svg class="logo-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="2.5" />
                <circle cx="16" cy="16" r="8" stroke="currentColor" stroke-width="2.5" />
                <path d="M12 16.5L14.5 19L20 13.5" stroke="#03DAC6" stroke-width="2.5" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
            <span class="logo-text">Focus & Goals</span>
        </a>
        <button id="settings-btn" title="Settings">⚙️</button>
    </div>

    <audio id="sound-player"></audio>
    <button id="enable-sound-btn">🔊 Enable Sound</button>

    <div class="main-content">
        <div class="dashboard-container">
            <div class="panel timer-panel on-focus">
                <h2 id="mode-display">Focus Mode</h2>
                <div class="mode-selectors">
                    <button class="mode-btn active" data-mode="focus">Focus</button>
                    <button class="mode-btn" data-mode="shortBreak">Short Break</button>
                    <button class="mode-btn" data-mode="longBreak">Long Break</button>
                </div>
                <div id="timer-display">40:00</div>
                <div class="timer-controls">
                    <button id="start-pause-btn">Start</button>
                    <button id="reset-btn">Reset</button>
                </div>
            </div>

            <div class="panel goals-panel">
                <div class="panel-title-header">
                    <h2 class="panel-title">Today's Goals</h2>
                    <button id="clear-completed-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z" />
                            <path
                                d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z" />
                        </svg>
                        <span>Clear Completed</span>
                    </button>
                </div>
                <form id="task-form">
                    <input type="text" id="task-input" placeholder="Add a new goal..." autocomplete="off">
                    <button type="submit" id="add-task-btn">+</button>
                </form>
                <ul id="task-list"></ul>
            </div>
        </div>
    </div>

    <div class="settings-modal" id="settings-modal" style="display:none; opacity: 0;">
       <div class="settings-content">
            <button class="close-modal-btn" id="close-modal-btn">&times;</button>
            <h2 class="panel-title" style="border:none; margin-bottom: 25px;">Settings</h2>
            <form id="settings-form">
                <div class="settings-columns-container">
                    <div class="settings-column">
                        <h3>Timer</h3>
                        <div class="setting-row">
                            <label for="focus-time">Focus Time</label>
                            <div class="number-input-wrapper">
                                <input type="number" id="focus-time" min="1" required>
                                <button type="button" class="adjust-btn up" data-for="focus-time" data-action="up"><svg
                                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z" />
                                    </svg></button>
                                <button type="button" class="adjust-btn down" data-for="focus-time"
                                    data-action="down"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
                                    </svg></button>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="short-break-time">Short Break</label>
                            <div class="number-input-wrapper">
                                <input type="number" id="short-break-time" min="1" required>
                                <button type="button" class="adjust-btn up" data-for="short-break-time"
                                    data-action="up"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z" />
                                    </svg></button>
                                <button type="button" class="adjust-btn down" data-for="short-break-time"
                                    data-action="down"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
                                    </svg></button>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="long-break-time">Long Break</label>
                            <div class="number-input-wrapper">
                                <input type="number" id="long-break-time" min="1" required>
                                <button type="button" class="adjust-btn up" data-for="long-break-time"
                                    data-action="up"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z" />
                                    </svg></button>
                                <button type="button" class="adjust-btn down" data-for="long-break-time"
                                    data-action="down"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
                                    </svg></button>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="sessions-before-long-break">Long Break Interval</label>
                            <div class="number-input-wrapper">
                                <input type="number" id="sessions-before-long-break" min="1" required>
                                <button type="button" class="adjust-btn up" data-for="sessions-before-long-break"
                                    data-action="up"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z" />
                                    </svg></button>
                                <button type="button" class="adjust-btn down" data-for="sessions-before-long-break"
                                    data-action="down"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
                                    </svg></button>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="auto-start-sessions">Auto-start Next Session</label>
                            <label class="switch">
                                <input type="checkbox" id="auto-start-sessions">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="settings-column">
                        <h3>Sounds</h3>
                        <div class="setting-row">
                            <label for="focus-sound">Focus End</label>
                            <select id="focus-sound">
                                <option value="sounds/beep.mp3">Simple Beep</option>
                                <option value="sounds/bell.mp3">Bell</option>
                                <option value="sounds/chime.mp3">Chime</option>
                                <option value="sounds/success.mp3">Success</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label for="short-break-sound">Short Break End</label>
                            <select id="short-break-sound">
                                <option value="sounds/bell.mp3">Default Alert</option>
                                <option value="sounds/chime.mp3">Chime</option>
                                <option value="sounds/beep.mp3">Simple Beep</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label for="long-break-sound">Long Break End</label>
                            <select id="long-break-sound">
                                <option value="sounds/success.mp3">Uplifting</option>
                                <option value="sounds/bell.mp3">Bell</option>
                                <option value="sounds/chime.mp3">Chime</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="button-group">
                    <button type="submit" id="save-settings-btn">Save Settings</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const soundPlayer = document.getElementById('sound-player');
            const enableSoundBtn = document.getElementById('enable-sound-btn');
            const timerDisplay = document.getElementById('timer-display');
            const modeDisplay = document.getElementById('mode-display');
            const startPauseBtn = document.getElementById('start-pause-btn');
            const resetBtn = document.getElementById('reset-btn');
            const timerPanel = document.querySelector('.timer-panel');
            const modeBtns = document.querySelectorAll('.mode-btn');
            const taskForm = document.getElementById('task-form');
            const taskInput = document.getElementById('task-input');
            const taskList = document.getElementById('task-list');
            const clearCompletedBtn = document.getElementById('clear-completed-btn');
            const settingsBtn = document.getElementById('settings-btn');
            const settingsModal = document.getElementById('settings-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const settingsForm = document.getElementById('settings-form');
            const focusTimeInput = document.getElementById('focus-time');
            const shortBreakTimeInput = document.getElementById('short-break-time');
            const longBreakTimeInput = document.getElementById('long-break-time');
            const sessionsInput = document.getElementById('sessions-before-long-break');
            const autoStartSessionsToggle = document.getElementById('auto-start-sessions');
            const focusSoundSelect = document.getElementById('focus-sound');
            const shortBreakSoundSelect = document.getElementById('short-break-sound');
            const longBreakSoundSelect = document.getElementById('long-break-sound');

            enableSoundBtn.addEventListener('click', () => {
                soundPlayer.volume = 0;
                soundPlayer.play().then(() => {
                    soundPlayer.pause();
                    soundPlayer.currentTime = 0;
                    soundPlayer.volume = 1;
                    enableSoundBtn.classList.add('hidden');
                    localStorage.setItem('soundEnabled', 'true');
                }).catch(e => console.error("Error initializing audio:", e));
            });

            if (localStorage.getItem('soundEnabled') === 'true') {
                enableSoundBtn.classList.add('hidden');
            }

            function playSound(url) {
                if (localStorage.getItem('soundEnabled') !== 'true') return;
                soundPlayer.pause();
                soundPlayer.currentTime = 0;
                soundPlayer.src = url;
                soundPlayer.play().catch(e => console.error("Playback failed! The error was:", e));
            }

            let focusTime = parseInt(localStorage.getItem('focusTime')) || 25;
            let shortBreakTime = parseInt(localStorage.getItem('shortBreakTime')) || 5;
            let longBreakTime = parseInt(localStorage.getItem('longBreakTime')) || 15;
            let sessionsBeforeLongBreak = parseInt(localStorage.getItem('sessionsBeforeLongBreak')) || 4;
            let autoStartSessions = localStorage.getItem('autoStartSessions') !== 'false';
            
            let focusSoundUrl = localStorage.getItem('focusSoundUrl') || 'sounds/beep.mp3';
            let shortBreakSoundUrl = localStorage.getItem('shortBreakSoundUrl') || 'sounds/bell.mp3';
            let longBreakSoundUrl = localStorage.getItem('longBreakSoundUrl') || 'sounds/success.mp3';

            let currentMode = 'focus';
            let focusSessionsCompleted = parseInt(localStorage.getItem('focusSessionsCompleted')) || 0;
            let isRunning = false;
            let timerInterval = null;

            function showNotification(title, body) {
                if (Notification.permission === 'granted') {
                    new Notification(title, { body: body, icon: 'https://cdn-icons-png.flaticon.com/512/148/148483.png' });
                }
            }

            function updateTimerDisplay(timeInSeconds) {
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                const firstTask = taskList.querySelector("li:not(.completed) .task-text");
                const currentTaskText = firstTask ? firstTask.textContent : (currentMode === 'focus' ? 'Focus' : 'Break');
                document.title = `${timerDisplay.textContent} - ${currentTaskText}`;
            }

            function setTimer(mode) {
                currentMode = mode;
                let timeInSeconds;
                switch (mode) {
                    case 'shortBreak':
                        timeInSeconds = shortBreakTime * 60;
                        modeDisplay.textContent = "Short Break";
                        timerPanel.classList.add('on-break');
                        timerPanel.classList.remove('on-focus');
                        break;
                    case 'longBreak':
                        timeInSeconds = longBreakTime * 60;
                        modeDisplay.textContent = "Long Break";
                        timerPanel.classList.add('on-break');
                        timerPanel.classList.remove('on-focus');
                        break;
                    default:
                        timeInSeconds = focusTime * 60;
                        modeDisplay.textContent = "Focus Mode";
                        timerPanel.classList.remove('on-break');
                        timerPanel.classList.add('on-focus');
                        break;
                }
                return timeInSeconds;
            }

            let currentTimeInSeconds = setTimer('focus');
            updateTimerDisplay(currentTimeInSeconds);

            function switchMode(newMode) {
                pauseTimer();
                currentMode = newMode;
                currentTimeInSeconds = setTimer(newMode);
                updateTimerDisplay(currentTimeInSeconds);
                modeBtns.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.mode === newMode);
                });
            }

            function startTimer() {
                isRunning = true;
                startPauseBtn.textContent = 'Pause';
                startPauseBtn.classList.add('running');
                timerInterval = setInterval(() => {
                    currentTimeInSeconds--;
                    if (currentTimeInSeconds < 0) {
                        clearInterval(timerInterval);
                        updateTimerDisplay(0);
                        let soundUrl, notificationTitle, notificationBody;
                        if (currentMode === 'focus') {
                            focusSessionsCompleted++;
                            localStorage.setItem('focusSessionsCompleted', focusSessionsCompleted);
                            soundUrl = focusSoundUrl;
                            notificationTitle = `Focus #${focusSessionsCompleted} over!`;
                            if (focusSessionsCompleted > 0 && focusSessionsCompleted % sessionsBeforeLongBreak === 0) {
                                currentTimeInSeconds = setTimer('longBreak');
                                notificationBody = `Time for a long ${longBreakTime}-minute break.`;
                            } else {
                                currentTimeInSeconds = setTimer('shortBreak');
                                notificationBody = `Time for a short ${shortBreakTime}-minute break.`;
                            }
                        } else {
                            soundUrl = (currentMode === 'shortBreak') ? shortBreakSoundUrl : longBreakSoundUrl;
                            notificationTitle = "Break's over!";
                            notificationBody = "Time to get back to focus.";
                            currentTimeInSeconds = setTimer('focus');
                        }
                        setTimeout(() => {
                            playSound(soundUrl);
                        }, 100);
                        showNotification(notificationTitle, notificationBody);
                        setTimeout(() => {
                            updateTimerDisplay(currentTimeInSeconds);
                            modeBtns.forEach(btn => {
                                btn.classList.toggle('active', btn.dataset.mode === currentMode);
                            });
                            if (autoStartSessions) {
                                startTimer();
                            } else {
                                pauseTimer();
                            }
                        }, 1000);
                        return;
                    }
                    updateTimerDisplay(currentTimeInSeconds);
                }, 1000);
            }

            function pauseTimer() {
                isRunning = false;
                startPauseBtn.textContent = 'Start';
                startPauseBtn.classList.remove('running');
                clearInterval(timerInterval);
            }

            function resetTimer() {
                pauseTimer();
                currentTimeInSeconds = setTimer(currentMode);
                updateTimerDisplay(currentTimeInSeconds);
            }
            
            modeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const selectedMode = btn.dataset.mode;
                    switchMode(selectedMode);
                });
            });

            startPauseBtn.addEventListener('click', () => {
                if (localStorage.getItem('soundEnabled') !== 'true') {
                    soundPlayer.volume = 0;
                    soundPlayer.play().then(() => {
                        soundPlayer.pause();
                        soundPlayer.currentTime = 0;
                        soundPlayer.volume = 1;
                        localStorage.setItem('soundEnabled', 'true');
                        enableSoundBtn.classList.add('hidden');
                    }).catch(()=>{});
                }
                if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                    Notification.requestPermission();
                }
                isRunning ? pauseTimer() : startTimer();
            });

            resetBtn.addEventListener('click', resetTimer);

            function toggleClearButton(){const completedTasksExist=taskList.querySelector("li.completed");clearCompletedBtn.style.display=completedTasksExist?"flex":"none"}function addTask(taskText){const li=document.createElement("li");li.innerHTML=`<label><input type="checkbox" class="task-checkbox"><span class="custom-checkbox"></span><span class="task-text">${taskText}</span></label><button class="delete-btn">×</button>`;taskList.appendChild(li)}function animateTaskReorder(taskItem,isCompleting){const first=taskItem.getBoundingClientRect();isCompleting?taskList.appendChild(taskItem):taskList.prepend(taskItem);const last=taskItem.getBoundingClientRect();const deltaX=first.left-last.left;const deltaY=first.top-last.top;requestAnimationFrame(()=>{taskItem.style.transform=`translate(${deltaX}px, ${deltaY}px)`;taskItem.style.transition="transform 0s";requestAnimationFrame(()=>{taskItem.style.transform="";taskItem.style.transition="transform 0.5s cubic-bezier(0.55, 0, 0.1, 1)"})});taskItem.classList.toggle("completed",isCompleting)}taskForm.addEventListener("submit",e=>{e.preventDefault();const taskText=taskInput.value.trim();if(taskText){addTask(taskText);taskInput.value=""}});taskList.addEventListener("click",e=>{const target=e.target;const taskItem=target.closest("li");if(!taskItem)return;if(target.classList.contains("task-checkbox")){animateTaskReorder(taskItem,target.checked);toggleClearButton()}if(target.classList.contains("delete-btn")){taskItem.style.opacity="0";setTimeout(()=>{taskItem.remove();toggleClearButton()},300)}});clearCompletedBtn.addEventListener("click",()=>{const completedTasks=taskList.querySelectorAll("li.completed");completedTasks.forEach(task=>{task.style.opacity="0";setTimeout(()=>{task.remove();toggleClearButton()},300)})});
            function openSettings(){settingsModal.style.display="flex";setTimeout(()=>settingsModal.style.opacity=1,10);focusTimeInput.value=focusTime;shortBreakTimeInput.value=shortBreakTime;longBreakTimeInput.value=longBreakTime;sessionsInput.value=sessionsBeforeLongBreak;autoStartSessionsToggle.checked=autoStartSessions;focusSoundSelect.value=focusSoundUrl;shortBreakSoundSelect.value=shortBreakSoundUrl;longBreakSoundSelect.value=longBreakSoundUrl}function closeSettings(){settingsModal.style.opacity=0;setTimeout(()=>settingsModal.style.display="none",400)}settingsBtn.addEventListener("click",openSettings);closeModalBtn.addEventListener("click",closeSettings);settingsModal.addEventListener("click",e=>{if(e.target===settingsModal)closeSettings()});settingsForm.addEventListener("submit",e=>{e.preventDefault();focusTime=parseInt(focusTimeInput.value);shortBreakTime=parseInt(shortBreakTimeInput.value);longBreakTime=parseInt(longBreakTimeInput.value);sessionsBeforeLongBreak=parseInt(sessionsInput.value);autoStartSessions=autoStartSessionsToggle.checked;focusSoundUrl=focusSoundSelect.value;shortBreakSoundUrl=shortBreakSoundSelect.value;longBreakSoundUrl=longBreakSoundSelect.value;localStorage.setItem("focusTime",focusTime);localStorage.setItem("shortBreakTime",shortBreakTime);localStorage.setItem("longBreakTime",longBreakTime);localStorage.setItem("sessionsBeforeLongBreak",sessionsBeforeLongBreak);localStorage.setItem("autoStartSessions",autoStartSessions);localStorage.setItem("focusSoundUrl",focusSoundUrl);localStorage.setItem("shortBreakSoundUrl",shortBreakSoundUrl);localStorage.setItem("longBreakSoundUrl",longBreakSoundUrl);closeSettings();if(!isRunning){focusSessionsCompleted=0;localStorage.setItem("focusSessionsCompleted",focusSessionsCompleted);switchMode("focus")}});
            settingsForm.addEventListener("click",e=>{const adjustButton=e.target.closest(".adjust-btn");if(!adjustButton)return;const inputId=adjustButton.dataset.for;const input=document.getElementById(inputId);if(!input)return;let value=parseInt(input.value)||0;const min=parseInt(input.min)||1;value+=adjustButton.dataset.action==="up"?1:-1;if(value<min)value=min;input.value=value});

            [focusSoundSelect, shortBreakSoundSelect, longBreakSoundSelect].forEach(select => {
                select.addEventListener('change', (event) => {
                    if (localStorage.getItem('soundEnabled') === 'true') {
                        playSound(event.target.value);
                    }
                });
            });

            toggleClearButton();
        });
    </script>

</body>
</html>
